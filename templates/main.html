<!doctype html>
<html>
  <head>
    <title> RoadWars </title>
    <style type="text/css">
        html, body { height: 100%; margin: 0; padding: 0; }
        #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script type="text/javascript">
var map;
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 50.879549, lng: 4.701242},
              zoom: 14
  });

  map.addListener('bounds_changed', function() {
    console.log(map.getBounds());
    var bounds = map.getBounds();

    var ne = bounds.getNorthEast();
    var neLat = ne.lat()
    var neLong = ne.lng()
    var sw = bounds.getSouthWest();
    var swLat = sw.lat()
    var swLong = sw.lng()

    var req = new XMLHttpRequest();
    req.addEventListener("load", function() {
      var resObj = JSON.parse(this.responseText);
      if (resObj["res"]) {
          var streets = resObj["streets"];
          for (var i = 0; i < streets.length; i++) {
            var color = "#" + (streets[i][3] & 0xFFFFFF).toString(16);
            var pos = new google.maps.LatLng(streets[i][1], streets[i][2]);
            var marker = new google.maps.Marker({
              position: pos, 
              map: map, 
              title: streets[i][0], 
              icon: {scale: 5, fillColor: color, fillOpacity: 1.0, strokeColor: color, path: google.maps.SymbolPath.CIRCLE}
            });
          }
      } else {
        console.log("error getting streets")
      }
    });
    req.open("GET", "/request?req=get-all-streets&neLat=" + neLat + "&neLong=" + neLong + "&swLat=" + swLat + "&swLong=" + swLong)
    req.send()
  });

}
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA32vHcaqlV25d0lKeaHvrtWDzXawxvu60&callback=initMap">
    </script>
  </body>
</html>
